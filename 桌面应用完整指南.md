# å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ - æ¡Œé¢åº”ç”¨å®Œæ•´æŒ‡å—

## ğŸ“¦ åº”ç”¨æ‰“åŒ…æˆåŠŸ

âœ… åº”ç”¨å·²æˆåŠŸæ‰“åŒ…ä¸ºç‹¬ç«‹çš„æ¡Œé¢åº”ç”¨
- **ä½ç½®**: `dist/å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app`
- **å¤§å°**: çº¦65MB
- **å¹³å°**: macOS (æ”¯æŒ Apple Silicon å’Œ Intel)

---

## ğŸ“Š ä¸€ã€æ•°æ®åº“é—®é¢˜è§£ç­”

### 1. æ•°æ®åº“æ˜¯å¦è·Ÿéšåº”ç”¨ï¼Ÿ

**å½“å‰çŠ¶æ€**ï¼šæ•°æ®åº“**ä¸ä¼š**è‡ªåŠ¨è·Ÿéšåº”ç”¨åˆ†å‘

**åŸå› **ï¼š
- æ‰“åŒ…æ—¶åŒ…å«çš„æ˜¯ç©ºçš„ `data/` ç›®å½•
- æ¯ä¸ªè€å¸ˆé¦–æ¬¡è¿è¡Œä¼šåˆ›å»ºè‡ªå·±çš„æ–°æ•°æ®åº“
- è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯æ¯ä½è€å¸ˆçš„æ•°æ®ç‹¬ç«‹

### 2. å¦‚ä½•è®©è€å¸ˆä½¿ç”¨ç°æœ‰æ•°æ®ï¼Ÿ

**æ–¹æ¡ˆAï¼šæ‰‹åŠ¨å¤åˆ¶æ•°æ®åº“ï¼ˆæ¨èï¼‰**

1. æ‰¾åˆ°ä½ çš„æ•°æ®åº“æ–‡ä»¶ï¼š`data/grade_manager.db`
2. å°†æ•°æ®åº“æ–‡ä»¶å‘ç»™è€å¸ˆ
3. è€å¸ˆé¦–æ¬¡è¿è¡Œåº”ç”¨åï¼Œæ‰¾åˆ°åº”ç”¨å†…çš„ `data/` ç›®å½•
4. å°†ä½ çš„æ•°æ®åº“æ–‡ä»¶å¤åˆ¶è¿›å»ï¼Œæ›¿æ¢åŸæœ‰æ–‡ä»¶
5. é‡å¯åº”ç”¨å³å¯

**æ•°æ®åº“ä½ç½®**ï¼š
```
å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app/Contents/Resources/data/grade_manager.db
```

**è®¿é—®æ–¹æ³•**ï¼š
- å³é”®ç‚¹å‡»åº”ç”¨ â†’ "æ˜¾ç¤ºåŒ…å†…å®¹" â†’ Contents â†’ Resources â†’ data

**æ–¹æ¡ˆBï¼šé¢„è£…æ•°æ®åº“ï¼ˆéœ€è¦é‡æ–°æ‰“åŒ…ï¼‰**

å¦‚æœéœ€è¦å°†æ•°æ®åº“æ‰“åŒ…è¿›åº”ç”¨ï¼š
1. ç¡®ä¿ `data/grade_manager.db` å­˜åœ¨ä¸”åŒ…å«æ•°æ®
2. é‡æ–°æ‰§è¡Œæ‰“åŒ…å‘½ä»¤
3. æ‰€æœ‰è€å¸ˆéƒ½ä¼šæœ‰ç›¸åŒçš„åˆå§‹æ•°æ®

---

## ğŸ‘¥ äºŒã€è€å¸ˆå¦‚ä½•å®‰è£…ä½¿ç”¨

### macOS ç”¨æˆ·å®‰è£…æ­¥éª¤

**æ­¥éª¤1ï¼šè·å–åº”ç”¨**
- ä»ä½ è¿™é‡Œè·å¾— `å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app` æ–‡ä»¶
- æˆ–è€…è·å¾—å‹ç¼©åŒ…åè§£å‹

**æ­¥éª¤2ï¼šå®‰è£…åº”ç”¨**
```
1. å°† å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app æ‹–åˆ°"åº”ç”¨ç¨‹åº"æ–‡ä»¶å¤¹
2. åŒå‡»æ‰“å¼€åº”ç”¨
```

**æ­¥éª¤3ï¼šé¦–æ¬¡è¿è¡Œï¼ˆé‡è¦ï¼‰**

é¦–æ¬¡æ‰“å¼€æ—¶ï¼ŒmacOS å¯èƒ½ä¼šæç¤º"æ— æ³•éªŒè¯å¼€å‘è€…"ï¼š

```
è§£å†³æ–¹æ³•ï¼š
1. æ‰“å¼€"ç³»ç»Ÿè®¾ç½®" > "éšç§ä¸å®‰å…¨æ€§"
2. æ‰¾åˆ°"å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ"çš„æç¤º
3. ç‚¹å‡»"ä»è¦æ‰“å¼€"
4. å†æ¬¡åŒå‡»åº”ç”¨å³å¯æ­£å¸¸ä½¿ç”¨
```

**æ­¥éª¤4ï¼šå¼€å§‹ä½¿ç”¨**
- åº”ç”¨ä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
- é»˜è®¤è´¦å·ï¼š`ddjia2022` / `ddjia2022`

### Windows ç”¨æˆ·

ç›®å‰åªæ‰“åŒ…äº† macOS ç‰ˆæœ¬ã€‚å¦‚éœ€ Windows ç‰ˆæœ¬ï¼š
- éœ€è¦åœ¨ Windows ç³»ç»Ÿä¸Šé‡æ–°æ‰“åŒ…
- æ‰“åŒ…å‘½ä»¤ç›¸åŒï¼Œä½†éœ€è¦ Windows ç¯å¢ƒ

---

## ğŸ¨ ä¸‰ã€å¦‚ä½•ä¿®æ”¹åº”ç”¨å›¾æ ‡

### å‡†å¤‡å›¾æ ‡æ–‡ä»¶

**macOS éœ€è¦ .icns æ ¼å¼å›¾æ ‡**

1. **å‡†å¤‡åŸå§‹å›¾ç‰‡**
   - æ¨èå°ºå¯¸ï¼š1024x1024 åƒç´ 
   - æ ¼å¼ï¼šPNGï¼ˆé€æ˜èƒŒæ™¯æ›´ä½³ï¼‰

2. **è½¬æ¢ä¸º .icns æ ¼å¼**

**æ–¹æ³•Aï¼šä½¿ç”¨åœ¨çº¿å·¥å…·ï¼ˆæœ€ç®€å•ï¼‰**
- è®¿é—®ï¼šhttps://cloudconvert.com/png-to-icns
- ä¸Šä¼ ä½ çš„å›¾ç‰‡ï¼Œè½¬æ¢ä¸º .icns æ ¼å¼
- ä¸‹è½½ç”Ÿæˆçš„ `icon.icns` æ–‡ä»¶

**æ–¹æ³•Bï¼šä½¿ç”¨ macOS å‘½ä»¤è¡Œ**
```bash
# åˆ›å»ºå›¾æ ‡é›†ç›®å½•
mkdir MyIcon.iconset

# ç”Ÿæˆä¸åŒå°ºå¯¸ï¼ˆéœ€è¦åŸå§‹å›¾ç‰‡ä¸º icon.pngï¼‰
sips -z 16 16     icon.png --out MyIcon.iconset/icon_16x16.png
sips -z 32 32     icon.png --out MyIcon.iconset/icon_16x16@2x.png
sips -z 32 32     icon.png --out MyIcon.iconset/icon_32x32.png
sips -z 64 64     icon.png --out MyIcon.iconset/icon_32x32@2x.png
sips -z 128 128   icon.png --out MyIcon.iconset/icon_128x128.png
sips -z 256 256   icon.png --out MyIcon.iconset/icon_128x128@2x.png
sips -z 256 256   icon.png --out MyIcon.iconset/icon_256x256.png
sips -z 512 512   icon.png --out MyIcon.iconset/icon_256x256@2x.png
sips -z 512 512   icon.png --out MyIcon.iconset/icon_512x512.png
sips -z 1024 1024 icon.png --out MyIcon.iconset/icon_512x512@2x.png

# è½¬æ¢ä¸º .icns
iconutil -c icns MyIcon.iconset
```

### åº”ç”¨å›¾æ ‡åˆ°æ‰“åŒ…é…ç½®

1. **å°†å›¾æ ‡æ–‡ä»¶æ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•**
```bash
# å°†ä½ çš„ icon.icns æ”¾åˆ°è¿™é‡Œ
/Users/chaoteng/Desktop/7c/edu/icon.icns
```

2. **ä¿®æ”¹æ‰“åŒ…é…ç½®æ–‡ä»¶**

æ‰“å¼€ `build_desktop.spec`ï¼Œæ‰¾åˆ°ç¬¬72è¡Œï¼š
```python
icon=None,
```

ä¿®æ”¹ä¸ºï¼š
```python
icon='icon.icns',
```

3. **é‡æ–°æ‰“åŒ…**
```bash
source .venv/bin/activate
rm -rf dist build
pyinstaller build_desktop.spec
```

æ‰“åŒ…å®Œæˆåï¼Œæ–°çš„åº”ç”¨å°±ä¼šæ˜¾ç¤ºä½ çš„è‡ªå®šä¹‰å›¾æ ‡äº†ï¼

---

## ğŸ”“ å››ã€æ¡Œé¢ç‰ˆå…ç™»å½•è®¾ç½®

### ä¸ºä»€ä¹ˆéœ€è¦å…ç™»å½•ï¼Ÿ

æ¡Œé¢åº”ç”¨æ˜¯å•æœºç‰ˆæœ¬ï¼Œæ¯ä½è€å¸ˆç‹¬ç«‹ä½¿ç”¨ï¼Œä¸éœ€è¦ç™»å½•éªŒè¯ã€‚

### å®ç°æ–¹æ³•

éœ€è¦ä¿®æ”¹åç«¯ä»£ç ï¼Œè®©æ¡Œé¢ç‰ˆè‡ªåŠ¨ç™»å½•ã€‚

**æ­¥éª¤1ï¼šä¿®æ”¹å¯åŠ¨å™¨ï¼Œæ·»åŠ è‡ªåŠ¨ç™»å½•æ ‡è¯†**

æ‰“å¼€ `app/desktop_launcher.py`ï¼Œåœ¨ç¬¬30è¡Œçš„ `uvicorn.run` ä¹‹å‰æ·»åŠ ï¼š

```python
# è®¾ç½®æ¡Œé¢æ¨¡å¼ç¯å¢ƒå˜é‡
os.environ['DESKTOP_MODE'] = 'true'
```

å®Œæ•´ä»£ç ï¼š
```python
def start_server():
    """åå°å¯åŠ¨FastAPIæœåŠ¡å™¨"""
    try:
        # è®¾ç½®å·¥ä½œç›®å½•
        base_path = get_resource_path()
        os.chdir(base_path)

        # æ·»åŠ åˆ°Pythonè·¯å¾„
        if base_path not in sys.path:
            sys.path.insert(0, base_path)

        # è®¾ç½®æ¡Œé¢æ¨¡å¼ç¯å¢ƒå˜é‡
        os.environ['DESKTOP_MODE'] = 'true'

        from app.main import app
        uvicorn.run(
            app,
            host="127.0.0.1",
            port=18765,
            log_level="warning"
        )
```

**æ­¥éª¤2ï¼šä¿®æ”¹ä¸»é¡µé¢ï¼Œæ£€æµ‹æ¡Œé¢æ¨¡å¼**

æ‰¾åˆ°ç™»å½•é¡µé¢çš„è·¯ç”±ï¼ˆé€šå¸¸åœ¨ `app/main.py` æˆ– `app/routes/` ç›®å½•ä¸‹ï¼‰ã€‚

æ·»åŠ æ¡Œé¢æ¨¡å¼æ£€æµ‹ï¼š

```python
import os

@app.get("/")
async def read_root():
    # æ£€æµ‹æ˜¯å¦ä¸ºæ¡Œé¢æ¨¡å¼
    if os.getenv('DESKTOP_MODE') == 'true':
        # æ¡Œé¢æ¨¡å¼ï¼šè‡ªåŠ¨ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µ
        response = RedirectResponse(url="/static/points.html")
        # è®¾ç½®é»˜è®¤ç™»å½•tokenï¼ˆå¦‚æœéœ€è¦ï¼‰
        response.set_cookie(key="access_token", value="desktop_auto_login")
        return response
    else:
        # Webæ¨¡å¼ï¼šæ˜¾ç¤ºç™»å½•é¡µé¢
        return FileResponse("app/static/login.html")
```

**æ­¥éª¤3ï¼šï¼ˆå¯é€‰ï¼‰ä¿®æ”¹APIè®¤è¯ä¸­é—´ä»¶**

å¦‚æœä½ çš„APIæœ‰è®¤è¯ä¸­é—´ä»¶ï¼Œéœ€è¦è®©æ¡Œé¢æ¨¡å¼è·³è¿‡è®¤è¯ï¼š

```python
# åœ¨è®¤è¯ä¸­é—´ä»¶ä¸­æ·»åŠ 
if os.getenv('DESKTOP_MODE') == 'true':
    # æ¡Œé¢æ¨¡å¼ï¼Œè·³è¿‡è®¤è¯
    return await call_next(request)
```

**æ­¥éª¤4ï¼šé‡æ–°æ‰“åŒ…**

```bash
source .venv/bin/activate
rm -rf dist build
pyinstaller build_desktop.spec
```

### ç®€åŒ–æ–¹æ¡ˆï¼ˆæ¨èï¼‰

å¦‚æœä¸æƒ³ä¿®æ”¹å¤ªå¤šä»£ç ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„æ–¹æ³•ï¼š

**ä¿®æ”¹å¯åŠ¨å™¨ï¼Œç›´æ¥æ‰“å¼€ä¸»é¡µ**

åœ¨ `app/desktop_launcher.py` çš„ç¬¬64è¡Œï¼Œå°†URLæ”¹ä¸ºç›´æ¥æ‰“å¼€ä¸»é¡µï¼š

```python
# åŸæ¥çš„ä»£ç 
webview.create_window(
    "å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ",
    "http://127.0.0.1:18765",  # è¿™ä¼šæ‰“å¼€ç™»å½•é¡µ
    ...
)

# ä¿®æ”¹ä¸º
webview.create_window(
    "å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ",
    "http://127.0.0.1:18765/static/points.html",  # ç›´æ¥æ‰“å¼€ä¸»é¡µ
    ...
)
```

è¿™æ ·åº”ç”¨å¯åŠ¨åä¼šç›´æ¥æ˜¾ç¤ºä¸»é¡µï¼Œè·³è¿‡ç™»å½•é¡µé¢ã€‚

---

## ğŸ“‹ äº”ã€å¿«é€Ÿæ“ä½œæ¸…å•

### åˆ†å‘ç»™è€å¸ˆçš„æ–‡ä»¶

**å¿…éœ€æ–‡ä»¶ï¼š**
1. `å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app` - åº”ç”¨ç¨‹åº

**å¯é€‰æ–‡ä»¶ï¼š**
2. `grade_manager.db` - æ•°æ®åº“æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦å…±äº«æ•°æ®ï¼‰
3. ä½¿ç”¨è¯´æ˜æ–‡æ¡£

### æ‰“åŒ…æ–°ç‰ˆæœ¬çš„å®Œæ•´æµç¨‹

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/chaoteng/Desktop/7c/edu

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# 3. æ¸…ç†æ—§æ–‡ä»¶
rm -rf dist build

# 4. æ‰§è¡Œæ‰“åŒ…
pyinstaller build_desktop.spec

# 5. æµ‹è¯•åº”ç”¨
open dist/å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app

# 6. å‹ç¼©åˆ†å‘ï¼ˆå¯é€‰ï¼‰
cd dist
zip -r å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.zip å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app
```

### å¸¸è§é—®é¢˜è§£å†³

**Q1: åº”ç”¨æ‰“ä¸å¼€ï¼Œæç¤º"å·²æŸå"**
```bash
# è§£å†³æ–¹æ³•ï¼šç§»é™¤éš”ç¦»å±æ€§
xattr -cr /Applications/å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app
```

**Q2: ç«¯å£18765è¢«å ç”¨**
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i:18765

# ç»“æŸè¿›ç¨‹
kill -9 [è¿›ç¨‹ID]
```

**Q3: å¦‚ä½•æŸ¥çœ‹åº”ç”¨æ—¥å¿—**
```bash
# ä»å‘½ä»¤è¡Œè¿è¡ŒæŸ¥çœ‹è¯¦ç»†è¾“å‡º
./dist/å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app/Contents/MacOS/å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ
```

**Q4: æ•°æ®åº“åœ¨å“ªé‡Œ**
```bash
# å³é”®åº”ç”¨ â†’ æ˜¾ç¤ºåŒ…å†…å®¹
# è·¯å¾„ï¼šContents/Resources/data/grade_manager.db
```

---

## ğŸ¯ å…­ã€æ€»ç»“

### å·²å®Œæˆçš„å·¥ä½œ

âœ… **CDNèµ„æºç¦»çº¿åŒ–**
- Font Awesome å­—ä½“åº“
- xlsx.full.min.js (Excelå¤„ç†)
- chart.min.js (å›¾è¡¨åº“)
- æ‰€æœ‰å¤–éƒ¨èµ„æºå·²æœ¬åœ°åŒ–

âœ… **æ¡Œé¢åº”ç”¨æ‰“åŒ…**
- æˆåŠŸæ‰“åŒ…ä¸º macOS .app åº”ç”¨
- å¤§å°çº¦65MB
- å®Œå…¨ç¦»çº¿è¿è¡Œ

âœ… **åŠŸèƒ½éªŒè¯**
- åº”ç”¨å¯ä»¥æ­£å¸¸å¯åŠ¨
- æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- æ‰€æœ‰åŠŸèƒ½å¯ç”¨

### ä¸‹ä¸€æ­¥å»ºè®®

**1. ä¿®æ”¹åº”ç”¨å›¾æ ‡**
- å‡†å¤‡ 1024x1024 çš„PNGå›¾ç‰‡
- è½¬æ¢ä¸º .icns æ ¼å¼
- ä¿®æ”¹ build_desktop.spec
- é‡æ–°æ‰“åŒ…

**2. å®ç°å…ç™»å½•**
- ä¿®æ”¹ desktop_launcher.py
- ç›´æ¥æ‰“å¼€ä¸»é¡µé¢
- æˆ–æ·»åŠ è‡ªåŠ¨ç™»å½•é€»è¾‘
- é‡æ–°æ‰“åŒ…

**3. å‡†å¤‡åˆ†å‘**
- å‹ç¼©åº”ç”¨ä¸º .zip
- å‡†å¤‡ä½¿ç”¨è¯´æ˜
- å¯é€‰ï¼šå‡†å¤‡æ•°æ®åº“æ–‡ä»¶

### æŠ€æœ¯æ”¯æŒ

å¦‚éœ€å¸®åŠ©ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. ä»å‘½ä»¤è¡Œè¿è¡Œåº”ç”¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
3. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼šæ§åˆ¶å°.app

---

## ğŸ“ è”ç³»æ–¹å¼

**é¡¹ç›®ä½ç½®**: `/Users/chaoteng/Desktop/7c/edu`

**å…³é”®æ–‡ä»¶**:
- åº”ç”¨ç¨‹åº: `dist/å­¦æ ¡æˆç»©ç®¡ç†ç³»ç»Ÿ.app`
- å¯åŠ¨å™¨: `app/desktop_launcher.py`
- æ‰“åŒ…é…ç½®: `build_desktop.spec`
- ä¾èµ–æ–‡ä»¶: `requirements_desktop.txt`

**æ‰“åŒ…å‘½ä»¤**:
```bash
source .venv/bin/activate && pyinstaller build_desktop.spec
```

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2026-01-02*
*åº”ç”¨ç‰ˆæœ¬: 1.0*
*å¹³å°: macOS (Apple Silicon & Intel)*

